---
- name: All Pis
  hosts: k8s

  pre_tasks:
    - name: Update repo cache
      become: yes
      apt:
        update_cache: yes

    - name: Upgrade installed software
      become: yes
      apt:
        upgrade: safe

  roles:
    - swapless
    - poe
    - cgroups
    - legacy-iptables
    - k3s-download

  handlers:
    - name: restart pi
      reboot:
        reboot_timeout: 120

- name: k8s-master
  hosts: masters

  roles:
    - k3s-master

- name: k8s-node
  hosts: nodes

  roles:
    - k3s-node
